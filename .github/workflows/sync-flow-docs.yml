# Open a PR in onflow/flow when a PR for docs in Cadence is merged
# The new PR is based on the last opened `auto-cadence-upgrade/*` if it exists, otherwise on the master branch
name: Sync onflow/flow docs

# Only run on pull requests merged to master
on:
  pull_request:
    branches:
      - master
    types: [closed]
    paths:
      - 'docs/**'
  workflow_dispatch:

jobs:
  sync-flow-go:
    runs-on: ubuntu-latest
    # the PR could have been closed otherwise. Only run if it has actually ben merged
    if: github.event.pull_request.merged == true
    steps:
      # create the pull request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.REMOTE_REPO_PAT }}
          commit-message: update Cadence docs
          title: "Auto Cadence Update"
          body: |
              Auto generated PR to update Cadence docs.

              References: ${{ github.event.pull_request.html_url }}
          branch: auto-cadence-upgrade/${{ github.event.pull_request.head.ref }}
          delete-branch: true
          assignees: turbolent
